<!DOCTYPE html>
<html>

<head>
    <style>
        * {
            margin:0;
            padding:0;
        }
        body {
            background-color: #e1e6e1;
            color: #73a580;
        }

        h1 {
            color: white;
            text-align: center;
        }

        label {
            color: #3e363f;
            font-size: 20px;
        }

        input {
            font-size: 13px;
            padding: 5px;
            border-radius: 5px;
            border-width: 1px;
            width: 12%
        }

        .tableFixHead {
            color: #3e363f;
            overflow-y: auto;
            height: 400px;
        }

        .tableFixHead thead th {
            color: #3e363f;
            background-color: #e1e6e1;
            position: sticky;
            top: 0px;
            border-spacing: 0;
            border-collapse: collapse;
            margin: 0;
        }

        table {
            color: #3e363f;
            border-collapse: collapse;
            width: 100%;
            margin: 0;
        }

        th,
        td {
            padding: 8px 16px;
            background: floralwhite;
            text-align: center;
            font-size: 25px;
            border-collapse: collapse;

        }

        th {
            color: #3e363f;
            font-family: "Lucida Sans Unicode", "Lucida Grande", sans-serif;
            font-size: 30px;
            text-align: center;
            background: #1abc9c;
            border-collapse: collapse;
        }

        .header {
            padding: 60px;
            margin-top: 0px;
            text-align: center;
            background: #73a580;
            color: #fffaca;
            font-size: 30px;
            font-family: "Lucida Sans Unicode", "Lucida Grande", sans-serif;
            font-weight: 700;
        }
        
        .recipebutton {
            margin-top: 20px;
        }
    </style>
</head>

<body>

    <div class="header">
        <h1>John's Refrigerator</h1>
    </div>

    <br>
    <div class="tableFixHead">
        <table id="ingredients">
            <thead>
                <tr>
                    <th></th>
                    <th>Current Ingredients</th>
                    <th>Amount</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><img src="./food-icons/onion.png" width="50" height="50"></td>
                    <td>onion</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td><img src="./food-icons/milk-carton.png" width="50" height="50"></td>
                    <td>milk</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td><img src="./food-icons/eggs.png" width="50" height="50"></td>
                    <td>eggs</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td><img src="./food-icons/sugar-cube.png" width="50" height="50"></td>
                    <td>sugar</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td><img src="./food-icons/salt-shaker.png" width="50" height="50"></td>
                    <td>salt</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td><img src="./food-icons/pepper-shaker.png" width="50" height="50"></td>
                    <td>pepper</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td><img src="./food-icons/steak.png" width="50" height="50"></td>
                    <td>ground beef</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td><img src="./food-icons/paprika.png" width="50" height="50"></td>
                    <td>bell pepper</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td><img src="./food-icons/mushroom.png" width="50" height="50"></td>
                    <td>mushroom</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td><img src="./food-icons/bacon.png" width="50" height="50"></td>
                    <td>bacon</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td><img src="./food-icons/cheese.png" width="50" height="50"></td>
                    <td>cheese</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td><img src="./food-icons/olive-oil.png" width="50" height="50"></td>
                    <td>olive oil</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td><img src="./food-icons/tomato.png" width="50" height="50"></td>
                    <td>tomato</td>
                    <td>1</td>
                </tr>
                <tr>
                    <td><img src="./food-icons/potato.png" width="50" height="50"></td>
                    <td>potato</td>
                    <td>1</td>
                </tr>
            </tbody>
        </table>
    </div>
    <br>

    <form align="center">
      <input type="search" oninput='onInput("vegetables", "vegetablesInput")' onfocus="this.value=''" onchange="this.blur();" id='vegetablesInput' list="vegetables" placeholder="Add Vegetables">
      <datalist id="vegetables">
        <option value="mushroom" />
        <option value="cauliflower" />
        <option value="potato" />
        <option value="corn" />
        <option value="soy" />
        <option value="beet" />
        <option value="carrot" />
        <option value="celery" />
        <option value="artichoke" />
        <option value="onion" />
        <option value="tomato" />
        <option value="asparagus" />
        <option value="sweet potato" />
        <option value="olive" />
        <option value="kohlrabi" />
        <option value="garlic" />
        <option value="peas" />
        <option value="leek" />
        <option value="salad" />
        <option value="cucumber" />
        <option value="eggplant" />
        <option value="spinach" />
        <option value="cabbage" />
        <option value="lettuce" />
        <option value="bell pepper" />
        <option value="radish" />
        <option value="broccoli" />
      </datalist>

      <input type="search" oninput='onInput("fruits", "fruitInput")' onfocus="this.value=''" onchange="this.blur();" id='fruitInput' list="fruits" placeholder="Add Fruits">
      <datalist id="fruits">
        <option value="papaya" />
        <option value="raspberry" />
        <option value="peach" />
        <option value="apricot" />
        <option value="lime" />
        <option value="squash" />
        <option value="durian" />
        <option value="coconut" />
        <option value="blueberry" />
        <option value="pineapple" />
        <option value="mango" />
        <option value="watermelon" />
        <option value="cherry" />
        <option value="orange" />
        <option value="grapes" />
        <option value="pomegranate" />
        <option value="pear" />
        <option value="melon" />
        <option value="honeydew" />
        <option value="avocado" />
        <option value="dragon fruit" />
        <option value="banana" />
        <option value="plum" />
        <option value="apple" />
        <option value="strawberry" />
        <option value="tangelo" />
        <option value="lemon" />
        <option value="pumpkin" />
        <option value="kiwi" />
        <option value="soursop" />
      </datalist>

      <input type="search" oninput='onInput("dairy", "dairyInput")' onfocus="this.value=''" onchange="this.blur();" id='dairyInput' list="dairy" placeholder="Add Dairy">
      <datalist id="dairy">
        <option value="milk" />
        <option value="coconut milk" />
        <option value="ice cream" />
        <option value="cheese" />
        <option value="yogurt" />
      </datalist>

      <input type="search" oninput='onInput("grains", "grainsInput")' onfocus="this.value=''" onchange="this.blur();" id='grainsInput' list="grains" placeholder="Add Grains">
      <datalist id="grains">
        <option value="rice" />
        <option value="naan" />
        <option value="bread" />
        <option value="flour" />
        <option value="nachos" />
        <option value="oats" />
        <option value="spaghetti" />
        <option value="noodles" />
      </datalist>

      <input type="search" oninput='onInput("meat", "meatInput")' onfocus="this.value=''" onchange="this.blur();" id='meatInput' list="meat" placeholder="Add Meat">
      <datalist id="meat">
        <option value="ham" />
        <option value="beef" />
        <option value="fish" />
        <option value="turkey" />
        <option value="salami" />
        <option value="octopus" />
        <option value="shellfish" />
        <option value="prawn" />
        <option value="sausage" />
        <option value="chicken" />
        <option value="crab" />
        <option value="bacon" />
        <option value="lamb" />
      </datalist>

      <input type="search" oninput='onInput("protein", "proteinInput")' onfocus="this.value=''" onchange="this.blur();" id='proteinInput' list="protein" placeholder="Add Protein">
      <datalist id="protein">
        <option value="eggs" />
        <option value="hazelnut" />
        <option value="ceshew" />
        <option value="brazil nut" />
        <option value="peanuts" />
        <option value="white beans" />
        <option value="lentil" />
      </datalist>

      <input type="search" oninput='onInput("other", "otherInput")' onfocus="this.value=''" onchange="this.blur();" id='otherInput' list="other" placeholder="Add Other">
      <datalist id="other">
        <option value="basil" />
        <option value="soy sauce" />
        <option value="candy" />
        <option value="thyme" />
        <option value="sugar" />
        <option value="pepper" />
        <option value="salt" />
        <option value="chili pepper" />
        <option value="honey" />
        <option value="chocolate" />
        <option value="mint" />
        <option value="coffee beans" />
        <option value="olive oil" />
        <option value="cinnamon" />
        <option value="mayonnaise" />
        <option value="worcestershire sauce" />
        <option value="salt" />
        <option value="ketchup" />
        <option value="mustard" />
        <option value="jam" />
      </datalist>
    </form>
    
    <div align="center">
        <input class="recipebutton" type=button value="Get Recipes" onClick="OpenPopupWindow();"> 
    </div>
    <script>
        var newWindow;
        function onInput(listName, inputName) {
            var val = document.getElementById(inputName).value;
            var opts = document.getElementById(listName).childNodes;

            for (var i = 1; i < opts.length; i++) {
                if (opts[i].value === val) {
                    var table = document.getElementById("ingredients");
                    var found = false;  
                    for (var r = 1, row; row = table.rows[r]; r++) {
                        if (row.cells[1].innerText === opts[i].value) {
                            console.log(row.cells[2].innerHTML);
                            row.cells[2].innerHTML = parseInt(row.cells[2].innerHTML) + 1;
                            found = true;
                            break;
                        }
                    }
                    if (found) break;

                    var table = document.getElementById("ingredients");
                    var row = table.insertRow(-1);
                    var cell1 = row.insertCell(0);
                    var cell2 = row.insertCell(1);
                    var cell3 = row.insertCell(2);

                    var img = document.createElement('img');
                    console.log(opts[i].val);
                    img.src = "./food-icons/" + opts[i].value + ".png";
                    img.width = 50;
                    img.height = 50;
                    cell1.appendChild(img);

                    cell2.innerHTML = opts[i].value;
                    cell3.innerHTML = "1";

                    break;
                }
            }
        }
        
        function OpenPopupWindow() {
            newWindow = window.open("recipelist.html" ,'mywin','left=20,top=20,width=700,height=700,toolbar=1,resizable=0');
            
            fetch('./recipe.json')
                    .then((response) => response.json())
                    .then((json) => receivedJSON(json));
            
            newWindow.focus();
        }
        
        function receivedJSON(json) {
            newWindow.document.body.textContent = " ";
            var table = document.getElementById("ingredients");
            var validRecipes = [];
            
            for (var i = 0; i < json.recipe.length; i++) {
                var recipe = json.recipe[i];
                var recipeMatches = true;
                
                inner:
                for (const ingredient of recipe.ingredients) {
                    var foundIngredient = false;
                    looptable:
                    for (var r = 1, row; row = table.rows[r]; r++) {
                        row = table.rows[r];
                        if (row.cells[1].innerText === ingredient) {
                            foundIngredient = true;
                            break looptable;
                        }
                    }

                    if (!foundIngredient) {
                        recipeMatches = false;
                        break inner;
                    }
                }

                if (recipeMatches) {
                    console.log(validRecipeCounter);
                    validRecipes.push(i);
                }
            }

            localStorage.setItem( "recipeJSON", JSON.stringify(json) );
            localStorage.setItem( 'validRecipes', JSON.stringify(validRecipes));
        }
    </script>
</body>
</html>
